# Open Questions - 未解问题与空白点

本文档记录三个来源中未充分说明的问题、矛盾之处和研究空白；并反映当前项目最新实现（含 listFiles 上限与截断）。

---
## 1. 架构设计问题

### 1.1 并行执行的实际效果
**问题**: Same.dev 等声称并行提升 3–5x 但缺基准；本项目当前选择单工具串行，避免并行冲突与复杂度。
**空白**: 并行对小型教育仓库的真实收益数据；冲突检测（写写/写读）策略。
**方向**: 构造合成任务对比响应时间；评估是否需要最小“读操作并行”实现。

### 1.2 消息历史修剪策略
**现状**: 采用无状态服务端；客户端已实现上下文历史（最近 20 条）并随请求发送；仍缺“修剪/摘要”策略规范。
**方向**: 经验值选 N=10–20；超出后仅保留最近 + 历史压缩摘要；考虑提供只读配置端点暴露当前阈值。

---
## 2. 工具系统问题

### 2.1 replaceText 重叠匹配风险
**现状**: 强制 old 唯一匹配；若未来出现“嵌套或重叠”误用需检测。
**开放问题**: 是否需要预扫描定位索引后验证连续性与单一性。
**可能策略**: 使用 indexOf + lastIndexOf + equals count；出现多次时返回所有上下文片段提示用户细化。

### 2.2 listFiles 大结果测试缺失
**现状**: 已实现 `max-list-results` + 截断提示；缺单测验证消息与边界（恰好等于上限 vs 超过）。
**方向**: 构造临时目录 ≥ (N+5) 文件；断言截断与未截断两种场景。

### 2.3 searchText 截断可配置粒度
**现状**: snippet 固定 100 字符；是否需要允许用户调整？
**风险**: 提升复杂度；教育版暂保持固定。

---
## 3. 验证与错误处理

### 3.1 集成测试覆盖不足
**现状**: 缺端到端（Controller + ChatClient + tool）验证 auto 路径。
**开放问题**: 是否需要模拟 ChatClient 失败/不可用时的降级路径？

### 3.2 Glob 安全边界可视化
**现状**: 文档已说明基路径提取与安全校验；缺示例展示 glob 越界被拒绝的错误消息格式。
**方向**: 增补示例：`List ../../secret/**/*` → Security error。

---
## 4. 配置与扩展

### 4.1 截断参数统一暴露
**现状**: max-file-lines / max-search-results / max-list-results 分离；UI 目前未显示这些值。
**开放问题**: 是否集中在单配置结构返回给前端？
**方向**: 增加只读配置端点（后续 UI 实现时再评估）。

### 4.2 显式“工具直连模式”
**现状**: 后端忽略 toolType；完全依赖模型进行工具选择与参数提取。
**开放问题**: 是否增加一个绕过模型的“直连模式”，以便在未配置代理/模型时仍可演示四个工具？
**方向**: 新增后端端点或在现有接口增加参数，允许显式调用 ToolsService 方法。

---
## 5. 文档一致性与维护

### 5.1 截断消息格式标准
**现状**:
- searchText 使用 `[TRUNCATED: reached limit <N> before completing search]`
- listFiles 使用 `[TRUNCATED: first N items]`
- readFile 使用 `[TRUNCATED: showing first N lines, M more available]`
**开放问题**: 统一格式 vs 保留差异（差异表达早停原因 vs 简单列表裁剪 vs 行数裁剪）。
**方向**: 保留差异以突出不同操作的截断语义差异。

### 5.2 术语与命名一致性
**现状**: 历史文档中仍有“ListDirTool”等旧称。
**方向**: 统一为实现口径：listFiles、readFile、searchText、replaceText。

---
## 6. 非当前优先的扩展主题（保持观察）
- 并行读操作（仅在真实性能瓶颈出现时）
- replaceText 多点编辑批处理模式（教育范围外）
- 截断后分页机制（当前固定返回前 N 条）
- 模型提示工程强化（当前最小 auto 名称分类足够）
- UI 增强：显示当前截断阈值；显式工具参数化（直连模式）

---
## 优先级建议
| 任务 | 优先级 | 原因 |
|------|---------|------|
| 集成测试 (auto) | 高 | 覆盖核心路径 |
| listFiles 截断单测 | 高 | 现有逻辑未验证 |
| UI 增强（阈值显示/直连模式） | 中 | 演示离线可用价值 |
| 会话期上下文摘要策略 | 中 | 教学连续性 |
| replaceText 重叠风险检测 | 低 | 尚无误用案例 |
| 截断格式统一决策 | 低 | 当前差异可解释 |

---
## 参考资料
- sources/notes-system-prompts.md
- sources/notes-coding-agent.md
- sources/notes-mini-swe-agent.md
- syntheses/architecture-patterns.md
- syntheses/code-modification.md

**最后更新**: 2025-10-19（同步最新实现状态）
